'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

exports.default = panable;
function panable(sprite, inertia) {

  function mouseDown(e) {
    start(e.data.originalEvent);
  }

  function touchStart(e) {
    start(e.data.originalEvent.targetTouches[0]);
  }

  function start(t) {
    if (sprite._pan) {
      if (!sprite._pan.intervalId) {
        return;
      }
      clearInterval(sprite._pan.intervalId);
      sprite.emit('panend');
    }
    sprite._pan = {
      p: {
        x: t.clientX,
        y: t.clientY,
        date: new Date()
      }
    };
    sprite.on('mousemove', mouseMove).on('touchmove', touchMove);
  }

  function mouseMove(e) {
    move(e, e.data.originalEvent);
  }

  function touchMove(e) {
    var t = e.data.originalEvent.targetTouches;
    if (!t || t.length > 1) {
      end(e, t[0]);
      return;
    }
    move(e, t[0]);
  }

  function move(e, t) {
    var now = new Date();
    var interval = now - sprite._pan.p.date;
    if (interval < 12) {
      return;
    }
    var dx = t.clientX - sprite._pan.p.x;
    var dy = t.clientY - sprite._pan.p.y;
    var distance = Math.sqrt(dx * dx + dy * dy);
    if (!sprite._pan.pp) {
      var threshold = t instanceof window.MouseEvent ? 2 : 7;
      if (distance > threshold) {
        sprite.emit('panstart');
      } else {
        return;
      }
    } else {
      var event = {
        deltaX: dx,
        deltaY: dy,
        velocity: distance / interval,
        data: e.data
      };
      sprite.emit('panmove', event);
    }
    sprite._pan.pp = {
      x: sprite._pan.p.x,
      y: sprite._pan.p.y,
      date: sprite._pan.p.date
    };
    sprite._pan.p = {
      x: t.clientX,
      y: t.clientY,
      date: now
    };
  }

  function mouseUp(e) {
    end(e, e.data.originalEvent);
  }

  function touchEnd(e) {
    end(e, e.data.originalEvent.changedTouches[0]);
  }

  function end(e, t) {
    sprite.removeListener('mousemove', mouseMove).removeListener('touchmove', touchMove);
    if (!sprite._pan || !sprite._pan.pp) {
      sprite._pan = null;
      return;
    }
    if (inertia) {
      var _ret = function () {
        if (sprite._pan.intervalId) {
          return {
            v: void 0
          };
        }
        var interval = new Date() - sprite._pan.pp.date;
        var vx = (t.clientX - sprite._pan.pp.x) / interval;
        var vy = (t.clientY - sprite._pan.pp.y) / interval;
        sprite._pan.intervalId = setInterval(function () {
          if (Math.abs(vx) < 0.04 && Math.abs(vy) < 0.04) {
            clearInterval(sprite._pan.intervalId);
            sprite.emit('panend');
            sprite._pan = null;
            return;
          }
          var touch = {
            clientX: sprite._pan.p.x + vx * 12,
            clientY: sprite._pan.p.y + vy * 12
          };
          move(e, touch);
          vx *= 0.9;
          vy *= 0.9;
        }, 12);
      }();

      if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === "object") return _ret.v;
    } else {
      sprite.emit('panend');
      sprite._pan = null;
    }
  }

  sprite.interactive = true;
  sprite.on('mousedown', mouseDown).on('touchstart', touchStart).on('mouseup', mouseUp).on('mouseupoutside', mouseUp).on('touchend', touchEnd).on('touchendoutside', touchEnd);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9nZXN0dXJlcy9wYW4uanMiXSwibmFtZXMiOlsicGFuYWJsZSIsInNwcml0ZSIsImluZXJ0aWEiLCJtb3VzZURvd24iLCJlIiwic3RhcnQiLCJkYXRhIiwib3JpZ2luYWxFdmVudCIsInRvdWNoU3RhcnQiLCJ0YXJnZXRUb3VjaGVzIiwidCIsIl9wYW4iLCJpbnRlcnZhbElkIiwiY2xlYXJJbnRlcnZhbCIsImVtaXQiLCJwIiwieCIsImNsaWVudFgiLCJ5IiwiY2xpZW50WSIsImRhdGUiLCJEYXRlIiwib24iLCJtb3VzZU1vdmUiLCJ0b3VjaE1vdmUiLCJtb3ZlIiwibGVuZ3RoIiwiZW5kIiwibm93IiwiaW50ZXJ2YWwiLCJkeCIsImR5IiwiZGlzdGFuY2UiLCJNYXRoIiwic3FydCIsInBwIiwidGhyZXNob2xkIiwid2luZG93IiwiTW91c2VFdmVudCIsImV2ZW50IiwiZGVsdGFYIiwiZGVsdGFZIiwidmVsb2NpdHkiLCJtb3VzZVVwIiwidG91Y2hFbmQiLCJjaGFuZ2VkVG91Y2hlcyIsInJlbW92ZUxpc3RlbmVyIiwidngiLCJ2eSIsInNldEludGVydmFsIiwiYWJzIiwidG91Y2giLCJpbnRlcmFjdGl2ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7a0JBQXdCQSxPO0FBQVQsU0FBU0EsT0FBVCxDQUFrQkMsTUFBbEIsRUFBMEJDLE9BQTFCLEVBQW1DOztBQUVoRCxXQUFTQyxTQUFULENBQW9CQyxDQUFwQixFQUF1QjtBQUNyQkMsVUFBTUQsRUFBRUUsSUFBRixDQUFPQyxhQUFiO0FBQ0Q7O0FBRUQsV0FBU0MsVUFBVCxDQUFxQkosQ0FBckIsRUFBd0I7QUFDdEJDLFVBQU1ELEVBQUVFLElBQUYsQ0FBT0MsYUFBUCxDQUFxQkUsYUFBckIsQ0FBbUMsQ0FBbkMsQ0FBTjtBQUNEOztBQUVELFdBQVNKLEtBQVQsQ0FBZ0JLLENBQWhCLEVBQW1CO0FBQ2pCLFFBQUlULE9BQU9VLElBQVgsRUFBaUI7QUFDZixVQUFJLENBQUNWLE9BQU9VLElBQVAs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QUFJd0MsUUFBUTtBQUNWbEMscUJBQVNoQixPQUFPVSxJQUFQLENBQVlJLENBQVosQ0FBY0MsQ0FBZCxHQUFrQitCLEtBQUssRUFEdEI7QUFFVjVCLHFCQUFTbEIsT0FBT1UsSUFBUCxDQUFZSSxDQUFaLENBQWNHLENBQWQsR0FBa0I4QixLQUFLO0FBRnRCLFdBQVo7QUFJQXZCLGVBQUtyQixDQUFMLEVBQVErQyxLQUFSO0FBQ0FKLGdCQUFNLEdBQU47QUFDQUMsZ0JBQU0sR0FBTjtBQUNELFNBZHdCLEVBY3RCLEVBZHNCLENBQXpCO0FBUFc7O0FBQUE7QUFzQlosS0F0QkQsTUFzQk87QUFDTC9DLGFBQU9hLElBQVAsQ0FBWSxRQUFaO0FBQ0FiLGFBQU9VLElBQVAsR0FBYyxJQUFkO0FBQ0Q7QUFDRjs7QUFFRFYsU0FBT21ELFdBQVAsR0FBcUIsSUFBckI7QUFDQW5ELFNBQ0dxQixFQURILENBQ00sV0FETixFQUNtQm5CLFNBRG5CLEVBRUdtQixFQUZILENBRU0sWUFGTixFQUVvQmQsVUFGcEIsRUFHR2MsRUFISCxDQUdNLFNBSE4sRUFHaUJxQixPQUhqQixFQUlHckIsRUFKSCxDQUlNLGdCQUpOLEVBSXdCcUIsT0FKeEIsRUFLR3JCLEVBTEgsQ0FLTSxVQUxOLEVBS2tCc0IsUUFMbEIsRUFNR3RCLEVBTkgsQ0FNTSxpQkFOTixFQU15QnNCLFFBTnpCO0FBT0QiLCJmaWxlIjoicGFuLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcGFuYWJsZSAoc3ByaXRlLCBpbmVydGlhKSB7XHJcblxyXG4gIGZ1bmN0aW9uIG1vdXNlRG93biAoZSkge1xyXG4gICAgc3RhcnQoZS5kYXRhLm9yaWdpbmFsRXZlbnQpXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB0b3VjaFN0YXJ0IChlKSB7XHJcbiAgICBzdGFydChlLmRhdGEub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzWzBdKVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc3RhcnQgKHQpIHtcclxuICAgIGlmIChzcHJpdGUuX3Bhbikge1xyXG4gICAgICBpZiAoIXNwcml0ZS5fcGFuLmludGVydmFsSWQpIHtcclxuICAgICAgICByZXR1cm5cclxuICAgICAgfVxyXG4gICAgICBjbGVhckludGVydmFsKHNwcml0ZS5fcGFuLmludGVydmFsSWQpXHJcbiAgICAgIHNwcml0ZS5lbWl0KCdwYW5lbmQnKVxyXG4gICAgfVxyXG4gICAgc3ByaXRlLl9wYW4gPSB7XHJcbiAgICAgIHA6IHtcclxuICAgICAgICB4OiB0LmNsaWVudFgsXHJcbiAgICAgICAgeTogdC5jbGllbnRZLFxyXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKClcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3ByaXRlXHJcbiAgICAgIC5vbignbW91c2Vtb3ZlJywgbW91c2VNb3ZlKVxyXG4gICAgICAub24oJ3RvdWNobW92ZScsIHRvdWNoTW92ZSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG1vdXNlTW92ZSAoZSkge1xyXG4gICAgbW92ZShlLCBlLmRhdGEub3JpZ2luYWxFdmVudClcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHRvdWNoTW92ZSAoZSkge1xyXG4gICAgbGV0IHQgPSBlLmRhdGEub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzXHJcbiAgICBpZiAoIXQgfHwgdC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGVuZChlLCB0WzBdKVxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuICAgIG1vdmUoZSwgdFswXSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG1vdmUgKGUsIHQpIHtcclxuICAgIGxldCBub3cgPSBuZXcgRGF0ZSgpXHJcbiAgICBsZXQgaW50ZXJ2YWwgPSBub3cgLSBzcHJpdGUuX3Bhbi5wLmRhdGVcclxuICAgIGlmIChpbnRlcnZhbCA8IDEyKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgbGV0IGR4ID0gdC5jbGllbnRYIC0gc3ByaXRlLl9wYW4ucC54XHJcbiAgICBsZXQgZHkgPSB0LmNsaWVudFkgLSBzcHJpdGUuX3Bhbi5wLnlcclxuICAgIGxldCBkaXN0YW5jZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSlcclxuICAgIGlmICghc3ByaXRlLl9wYW4ucHApIHtcclxuICAgICAgbGV0IHRocmVzaG9sZCA9ICh0IGluc3RhbmNlb2Ygd2luZG93Lk1vdXNlRXZlbnQpID8gMiA6IDdcclxuICAgICAgaWYgKGRpc3RhbmNlID4gdGhyZXNob2xkKSB7XHJcbiAgICAgICAgc3ByaXRlLmVtaXQoJ3BhbnN0YXJ0JylcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm5cclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IGV2ZW50ID0ge1xyXG4gICAgICAgIGRlbHRhWDogZHgsXHJcbiAgICAgICAgZGVsdGFZOiBkeSxcclxuICAgICAgICB2ZWxvY2l0eTogZGlzdGFuY2UgLyBpbnRlcnZhbCxcclxuICAgICAgICBkYXRhOiBlLmRhdGFcclxuICAgICAgfVxyXG4gICAgICBzcHJpdGUuZW1pdCgncGFubW92ZScsIGV2ZW50KVxyXG4gICAgfVxyXG4gICAgc3ByaXRlLl9wYW4ucHAgPSB7XHJcbiAgICAgIHg6IHNwcml0ZS5fcGFuLnAueCxcclxuICAgICAgeTogc3ByaXRlLl9wYW4ucC55LFxyXG4gICAgICBkYXRlOiBzcHJpdGUuX3Bhbi5wLmRhdGVcclxuICAgIH1cclxuICAgIHNwcml0ZS5fcGFuLnAgPSB7XHJcbiAgICAgIHg6IHQuY2xpZW50WCxcclxuICAgICAgeTogdC5jbGllbnRZLFxyXG4gICAgICBkYXRlOiBub3dcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG1vdXNlVXAgKGUpIHtcclxuICAgIGVuZChlLCBlLmRhdGEub3JpZ2luYWxFdmVudClcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHRvdWNoRW5kIChlKSB7XHJcbiAgICBlbmQoZSwgZS5kYXRhLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0pXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBlbmQgKGUsIHQpIHtcclxuICAgIHNwcml0ZVxyXG4gICAgICAucmVtb3ZlTGlzdGVuZXIoJ21vdXNlbW92ZScsIG1vdXNlTW92ZSlcclxuICAgICAgLnJlbW92ZUxpc3RlbmVyKCd0b3VjaG1vdmUnLCB0b3VjaE1vdmUpXHJcbiAgICBpZiAoIXNwcml0ZS5fcGFuIHx8ICFzcHJpdGUuX3Bhbi5wcCkge1xyXG4gICAgICBzcHJpdGUuX3BhbiA9IG51bGxcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcbiAgICBpZiAoaW5lcnRpYSkge1xyXG4gICAgICBpZiAoc3ByaXRlLl9wYW4uaW50ZXJ2YWxJZCkge1xyXG4gICAgICAgIHJldHVyblxyXG4gICAgICB9XHJcbiAgICAgIGxldCBpbnRlcnZhbCA9IG5ldyBEYXRlKCkgLSBzcHJpdGUuX3Bhbi5wcC5kYXRlXHJcbiAgICAgIGxldCB2eCA9ICh0LmNsaWVudFggLSBzcHJpdGUuX3Bhbi5wcC54KSAvIGludGVydmFsXHJcbiAgICAgIGxldCB2eSA9ICh0LmNsaWVudFkgLSBzcHJpdGUuX3Bhbi5wcC55KSAvIGludGVydmFsXHJcbiAgICAgIHNwcml0ZS5fcGFuLmludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKE1hdGguYWJzKHZ4KSA8IDAuMDQgJiYgTWF0aC5hYnModnkpIDwgMC4wNCkge1xyXG4gICAgICAgICAgY2xlYXJJbnRlcnZhbChzcHJpdGUuX3Bhbi5pbnRlcnZhbElkKVxyXG4gICAgICAgICAgc3ByaXRlLmVtaXQoJ3BhbmVuZCcpXHJcbiAgICAgICAgICBzcHJpdGUuX3BhbiA9IG51bGxcclxuICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdG91Y2ggPSB7XHJcbiAgICAgICAgICBjbGllbnRYOiBzcHJpdGUuX3Bhbi5wLnggKyB2eCAqIDEyLFxyXG4gICAgICAgICAgY2xpZW50WTogc3ByaXRlLl9wYW4ucC55ICsgdnkgKiAxMlxyXG4gICAgICAgIH1cclxuICAgICAgICBtb3ZlKGUsIHRvdWNoKVxyXG4gICAgICAgIHZ4ICo9IDAuOVxyXG4gICAgICAgIHZ5ICo9IDAuOVxyXG4gICAgICB9LCAxMilcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNwcml0ZS5lbWl0KCdwYW5lbmQnKVxyXG4gICAgICBzcHJpdGUuX3BhbiA9IG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNwcml0ZS5pbnRlcmFjdGl2ZSA9IHRydWVcclxuICBzcHJpdGVcclxuICAgIC5vbignbW91c2Vkb3duJywgbW91c2VEb3duKVxyXG4gICAgLm9uKCd0b3VjaHN0YXJ0JywgdG91Y2hTdGFydClcclxuICAgIC5vbignbW91c2V1cCcsIG1vdXNlVXApXHJcbiAgICAub24oJ21vdXNldXBvdXRzaWRlJywgbW91c2VVcClcclxuICAgIC5vbigndG91Y2hlbmQnLCB0b3VjaEVuZClcclxuICAgIC5vbigndG91Y2hlbmRvdXRzaWRlJywgdG91Y2hFbmQpXHJcbn1cclxuIl19